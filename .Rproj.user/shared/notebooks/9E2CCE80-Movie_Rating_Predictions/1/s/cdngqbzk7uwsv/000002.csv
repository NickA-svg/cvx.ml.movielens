"0","matrix_fact <-"
"0","  function(R,P,Q,K, steps=5000,alpha=0.002,beta=0.02){"
"0","    #R rating matrix"
"0","    #P user features matrix"
"0","    #Q item (movie) features matrix"
"0","    #K latent features"
"0","    #steps = iterations"
"0","    #alpha = learning rate"
"0","    #beta = regularization param"
"0","    Q = t(Q)"
"0","    for (step in 1:steps){"
"0","      for (i in 1:nrow(R)){"
"0","        for (j in 1:ncol(R)){"
"0","          if (R[i,j] >0) {"
"0",""
"0","            eij <- R[i,j] - (P[i,]%*%Q[,j])"
"0",""
"0","            for (k in 1:K){"
"0","              P[i,k] = P[i,k] + alpha * (2 * eij * Q[k,j] - beta * P[i,k])"
"0","              Q[k,j] = Q[k,j] + alpha * (2 * eij * P[i,k] - beta * Q[k,j])"
"0","            }"
"0","          }"
"0","        }"
"0","      }"
"0",""
"0","    e = 0"
"0",""
"0","    for (i in 1:nrow(R)){"
"0",""
"0","      for (j in 1:ncol(R)){"
"0",""
"0","        if (R[i,j] > 0) {"
"0",""
"0","          e = e + (R[i,j]-(P[i,]%*%Q[,j]))^2"
"0",""
"0","          for (k in 1:K){"
"0","            e = e + (beta/2) * ((P[i,k])^2+ (Q[k,j])^2)"
"0","          }"
"0",""
"0","        }"
"0",""
"0","      }"
"0",""
"0","    }"
"0",""
"0","    if (e < 0.001){"
"0","      break"
"0","    }"
"0",""
"0","    }"
"0",""
"0","    return(list("
"0","          P=P,"
"0","          Q = t(Q))"
"0","    )"
"0",""
"0","  }"

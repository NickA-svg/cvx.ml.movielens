"0","ls_focused <- seq(0, 2, 0.1)"
"0",""
"0","reg_rmses_focused <- sapply(ls_focused, function(l) {"
"0",""
"0","   # Calculate the regularized avges for movie, user, genre, and time"
"0","   "
"0","   movie_avgs_reg <- edx %>%"
"0","      group_by(movieId) %>%"
"0","      summarize(b_i = sum(rating - mu) / (n() + l))"
"0","   "
"0","   user_avgs_reg <- edx %>%"
"0","      left_join(movie_avgs_reg, by='movieId') %>%"
"0","      group_by(userId) %>%"
"0","      summarize(b_u = sum(rating - mu - b_i) / (n() + l))"
"0","   "
"0","    genre_avgs_reg <- edx %>%"
"0","      left_join(movie_avgs_reg, by='movieId') %>%"
"0","      left_join(user_avgs_reg, by='userId') %>%"
"0","      group_by(genres) %>%"
"0","      summarize(b_g = sum(rating - mu - b_i - b_u) / (n() + l))"
"0","    "
"0","    year_avgs_reg <- edx %>% "
"0","      left_join(movie_avgs_reg, by='movieId') %>%"
"0","      left_join(user_avgs_reg, by='userId') %>%"
"0","      left_join(genre_avgs_reg, by='genres') %>%"
"0","      group_by(Year) %>%"
"0","      summarize(b_yr = sum(rating - mu - b_i - b_u - b_g) / (n() + l))"
"0","  "
"0","   #predict the movie ratings on edx set"
"0","   pred_movie_user_genre_year_reg <- edx %>%"
"0","      left_join(movie_avgs_reg, by='movieId') %>%"
"0","      left_join(user_avgs_reg, by='userId') %>%"
"0","      left_join(genre_avgs_reg, by='genres') %>%"
"0","      left_join(year_avgs_reg, by='Year') %>%"
"0","      mutate(pred = mu + b_i + b_u + b_g + b_yr) %>%"
"0","      pull(pred)"
"0","   "
"0","   #calculate RMSE"
"0","   RMSE(edx$rating, pred_movie_user_genre_year_reg)"
"0","})"
"0",""
"0","# pick the final lambda"
"0","plot(ls_focused, reg_rmses_focused)"

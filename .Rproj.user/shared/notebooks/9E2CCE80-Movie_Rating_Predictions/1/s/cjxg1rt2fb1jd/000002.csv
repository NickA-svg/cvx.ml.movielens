"0","l_final <- ls_focused[which.min(reg_rmses_focused)]"
"0",""
"0","reg_rmse_validation <- sapply(l_final, function(l) {"
"0",""
"0","   # Calculate the regularized avg for movie, user, genre, and time"
"0","   movie_avgs_reg <- validation %>%"
"0","      group_by(movieId) %>%"
"0","      summarize(b_i = sum(rating - mu) / (n() + l))"
"0","   "
"0","   user_avgs_reg <- validation %>%"
"0","      left_join(movie_avgs_reg, by='movieId') %>%"
"0","      group_by(userId) %>%"
"0","      summarize(b_u = sum(rating - mu - b_i) / (n() + l))"
"0","   "
"0","    genre_avgs_reg <- validation %>%"
"0","      left_join(movie_avgs_reg, by='movieId') %>%"
"0","      left_join(user_avgs_reg, by='userId') %>%"
"0","      group_by(genres) %>%"
"0","      summarize(b_g = sum(rating - mu - b_i - b_u) / (n() + l))"
"0","    "
"0","    year_avgs_reg <- validation %>% "
"0","      left_join(movie_avgs_reg, by='movieId') %>%"
"0","      left_join(user_avgs_reg, by='userId') %>%"
"0","      left_join(genre_avgs_reg, by='genres') %>%"
"0","      group_by(Year) %>%"
"0","      summarize(b_yr = sum(rating - mu - b_i - b_u - b_g) / (n() + l))"
"0","  "
"0","   #predict the movie ratings on validation set"
"0","   pred_movie_user_genre_year_reg <- validation %>%"
"0","      left_join(movie_avgs_reg, by='movieId') %>%"
"0","      left_join(user_avgs_reg, by='userId') %>%"
"0","      left_join(genre_avgs_reg, by='genres') %>%"
"0","      left_join(year_avgs_reg, by='Year') %>%"
"0","      mutate(pred = mu + b_i + b_u + b_g + b_yr) %>%"
"0","      .$pred"
"0","   "
"0","   #calculate RMSE"
"0","   RMSE(validation$rating, pred_movie_user_genre_year_reg)"
"0","})"
